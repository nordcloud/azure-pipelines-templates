# Version 1.0.0
# Maintainer: Tadas Kazlauskas
# You need your global variables set anyways
# Parameters:
# JF_SERVER_ID: JFrog server id (default: nordcloud.jfrog.io)
# JF_ACCESS_TOKEN: JFrog access token
# JF_NPM_REPO: JFrog virtual repository name
# JFROG_CLI_VERSION: JFrog CLI version

parameters:
- name: jf_server_id 
  default: 
- name: jf_npm_repo 
  default: npm-virtual
- name: jf_user 
  default: pat-devops
- name: jf_access_token 
  default: 
- name: work_dir 
  default: 

steps:
  - script: |
      pwd
      echo "Creating .npmrc"
      echo "registry=https://${{ parameters.jf_server_id }}/artifactory/api/npm/${{ parameters.jf_npm_repo }}/" > .npmrc
      echo "@nordcloud:registry=https://${{ parameters.jf_server_id }}/artifactory/api/npm/${{ parameters.jf_npm_repo }}/" >> .npmrc
      echo -n "//${{ parameters.jf_server_id }}/artifactory/api/npm/${{ parameters.jf_npm_repo }}/:" >> .npmrc
      curl -u${{ parameters.jf_user }}:${{ parameters.jf_access_token }} https://${{ parameters.jf_server_id }}/artifactory/api/npm/auth >> .npmrc
      echo "email = pat-devops@nordcloud.com" >> .npmrc
      cat .npmrc
    displayName: "Configure JFrog proxy for NPM"
    workingDirectory: ${{ work_dir }}
